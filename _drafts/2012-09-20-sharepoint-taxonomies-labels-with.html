---
layout: post
title: SharePoint Taxonomies - Labels with forbiden characters
date: '2012-09-20T17:02:00.001+02:00'
author: Marek Mierzwa
tags:
- term
- taxonomy
- sharepoint 2010
modified_time: '2012-11-11T22:18:29.430+01:00'
thumbnail: http://1.bp.blogspot.com/-SAP8arTTUqg/UKAVO2yx8-I/AAAAAAAABUc/Kv_jLd8n_PI/s72-c/sp_mmd_picker.png
blogger_id: tag:blogger.com,1999:blog-2283486810269355053.post-442845803444553887
blogger_orig_url: http://byteloom.blogspot.com/2012/09/sharepoint-taxonomies-labels-with.html
---

Recently, when I was working on mechanism of automatic synchronization of tree structures provided by web service to SharePoint taxonomies, I came across an error like this:<br /><br /><pre class="brush: text">The value '(&lt;= 0320-775, 0550-5/7)' is invalid. It probably contains invalid characters or is too long.<br />Parameter name: name<br /></pre>with the following stacktrace fragment:<br /><pre class="brush: text">at Microsoft.SharePoint.Taxonomy.Internal.CommonValidator.ValidateName(String name, String parameterName)<br />at Microsoft.SharePoint.Taxonomy.TermSetItem.CreateTerm(String name, Int32 lcid, Guid newTermId)<br />...<br /></pre><a name='more'></a><br />Looking for some help in SharePoint API documentation for method <a href="http://msdn.microsoft.com/en-us/library/ee583797.aspx" target="_blank">TermSetItem.CreateTerm()</a> I found the explanation for this error:  <br /><blockquote>The labelName value will be normailized to trim consecutive spaces into one and replace the &amp; character with the wide character version of the character (\uFF06). It must be non-empty, cannot exceed 255 characters, and cannot contain any of the following characters ;"&lt; &gt;|&amp;tab </blockquote>Yeah, this is SharePoint... No surprise, I would say ;)<br /><br />Since I had to put the forbidden characters into the term labels somehow, my first thought was to encode them as HTML entities. But as you may noticed it is impossible - the ampersand character is replaced by similar looking unicode character with code \uFF06.<br /><br />My second try - why not to try the same as MS SharePoint developers? You will find many UTF-16 characters that look almost exactly the same as the characters from ASCII set. The replacements for the forbidden characters in UTF-8 are:<br /><br /><table><tbody><tr>   <td><b>Original ASCII char</b></td>   <td><b>UTF-8 replacement code</b></td> <td><b>UTF-8 char</b></td>  </tr><tr>   <td>|</td>   <td>\uFF5C</td> <td>｜</td>  </tr><tr>   <td>"</td>   <td>\uFF02</td> <td>＂</td> </tr><tr>   <td>&lt;</td>   <td>\uFF1C</td> <td>＜</td> </tr><tr>   <td>&gt;</td>   <td>\uFF1E</td> <td>＞</td> </tr></tbody></table><br />Unfortunetly I found no replacement for semicolon character so I'm replacing it with coma. You can find more information about these characters on <a href="http://www.fileformat.info/info/unicode" target="_blank">FileFormat</a>.<br /><br />Of course you will have to create the term grammatically to put them into term label (or copy them from some unicode table, such as <a href="http://www.fileformat.info/info/unicode" target="_blank">FileFormat</a>). Here is a utility method that should "normalize" the strings for CreateTerm() method:<br /><br /><pre class="brush: csharp">public static string ReplaceIllegalCharacters(string termLabel)<br />{<br />    return termLabel.<br />        Replace("\t", " ").<br />        Replace(";", ",").<br />        Replace("\"", "\uFF02").<br />        Replace("&lt;", "\uFF1C").<br />        Replace("&gt;", "\uFF1E").<br />        Replace("|", "\uFF5C");<br />}<br /></pre><br />This works fine either in web interface and other clients (I've tested it with MS Word 2010 and Lotus Notes widget for SharePoint integration - <a href="http://harmon.ie/" target="_blank">Harmon.IE</a>). <strike>I will put here some screenshots soon.</strike><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-SAP8arTTUqg/UKAVO2yx8-I/AAAAAAAABUc/Kv_jLd8n_PI/s1600/sp_mmd_picker.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="320" src="http://1.bp.blogspot.com/-SAP8arTTUqg/UKAVO2yx8-I/AAAAAAAABUc/Kv_jLd8n_PI/s320/sp_mmd_picker.png" width="302" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">SharePoint web UI term picker</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-mbCdBL5AwqQ/UKAVQ2zk4_I/AAAAAAAABUs/j4t-197_DSk/s1600/word_mmd_picker.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="295" src="http://3.bp.blogspot.com/-mbCdBL5AwqQ/UKAVQ2zk4_I/AAAAAAAABUs/j4t-197_DSk/s320/word_mmd_picker.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">MS Word term picker</td><td class="tr-caption" style="text-align: center;"><br /></td><td class="tr-caption" style="text-align: center;"><br /></td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-ed4WqJ5x-sc/UKAVNoj3GvI/AAAAAAAABUY/9mgpYmbgm-k/s1600/harmonie_mmd_picker.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="277" src="http://2.bp.blogspot.com/-ed4WqJ5x-sc/UKAVNoj3GvI/AAAAAAAABUY/9mgpYmbgm-k/s320/harmonie_mmd_picker.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Harmon.IE term picker</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-1VODjYIH_QQ/UKAVP-_8jCI/AAAAAAAABUk/8mXxvYX9eHw/s1600/term_store_management_tool.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-1VODjYIH_QQ/UKAVP-_8jCI/AAAAAAAABUk/8mXxvYX9eHw/s1600/term_store_management_tool.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">SharePoint TermStore management tool (Central Administration)</td></tr></tbody></table><br />Happy SharePointing!